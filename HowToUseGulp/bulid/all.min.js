function statisticsDay(){if(isDev)$.post("/api/services/app/orderRepair/RepairStatistics?repairType=1",null,function(e){if(0!=e.result.spReportOrderDateOutputs.length){$("#topChart").children(".portlet-body").hasClass("on")?$(this).next().removeClass("on"):($(this).addClass("on"),$(this).next().removeClass("on"));var t=[],a=new Date;a=a.setMonth(a.getMonth()-1);for(var i=Math.floor((new Date-a)/864e5),r=new Date,s=0;s<=i;s++){for(var n=moment(r).format("MM/DD"),l=!1,d=e.result.spReportOrderDateOutputs,o=0;o<d.length;o++){var p=d[o].date,u=p.substring(5,10);if(u==n){l=!0,t[t.length]={date:d[o].date.substring(5,10),distance:d[o].count};break}}l||(t[t.length]={date:n}),r.setDate(r.getDate()-1)}initChartSample1(t.reverse(),"date","MM-DD"),$(".repairTotal").text(e.result.total),$(".repairTypeNumber").text(e.result.repairTypeNumber),$(".repairTypeSpan").text("今日报修量")}else $("#topChart").children(".portlet-body").removeClass("on").next().addClass("on")});else{var e=[{date:"2012-02-01",distance:87},{date:"2012-02-02",distance:22},{date:"2012-02-03",distance:32},{date:"2012-02-04",distance:12},{date:"2012-02-05",distance:32},{date:"2012-02-06",distance:22},{date:"2012-02-07",distance:22},{date:"2012-02-08",distance:12},{date:"2012-02-09",distance:12},{date:"2012-02-10",distance:21},{date:"2012-02-11",distance:22},{date:"2012-02-12",distance:22},{date:"2012-02-13",townName:"Salt Lake City",distance:21},{date:"2012-02-14",distance:12},{date:"2012-02-15",distance:35},{date:"2012-02-16",distance:87},{date:"2012-02-17",distance:35},{date:"2012-02-18",distance:77},{date:"2012-02-19",distance:100},{date:"2012-02-20",distance:44},{date:"2012-02-21",distance:33},{date:"2012-02-22",distance:100},{date:"2012-02-23",distance:5},{date:"2012-02-24",distance:5},{date:"2012-02-25",distance:88},{date:"2012-02-26",distance:77},{date:"2012-02-27",distance:3},{date:"2012-02-28",distance:1},{date:"2012-02-29",distance:22},{date:"2012-02-30",distance:12},{date:"2012-02-31",distance:1}];initChartSample1(e,"date"),$(".repairTotal").text(106),$(".repairTypeNumber").text(13),$(".repairTypeSpan").text("今日报修量")}}function statisticsWeek(){$.post("/api/services/app/orderRepair/RepairStatistics?repairType=2",null,function(e){for(var t=[],a=0;a<e.result.length;a++)t[t.length]={date:e.result[a].date,distance:e.result[a].count};initChartSample1(t,"DD")})}function statisticsMonth(){if(isDev)$.post("/api/services/app/orderRepair/RepairStatistics?repairType=3",null,function(e){if(0!=e.result.spReportOrderDateOutputs.length){$("#topChart").children(".portlet-body").hasClass("on")?$(this).next().removeClass("on"):($(this).addClass("on"),$(this).next().removeClass("on"));for(var t=[],a=new Date,i=0;i<12;i++){for(var r=moment(a).format("YYYY/MM"),s=!1,n=e.result.spReportOrderDateOutputs,l=0;l<n.length;l++)if(r==n[l].date){t[t.length]={date:n[l].date,distance:n[l].count},s=!0;break}s||(t[t.length]={date:r}),a.setMonth(a.getMonth()-1)}initChartSample1(t.reverse(),"date","MM"),$(".repairTotal").text(e.result.total),$(".repairTypeNumber").text(e.result.repairTypeNumber),$(".repairTypeSpan").text("本月报修量")}else $("#topChart").removeClass("on").children(".portlet-body").next().addClass("on")});else{var e=[{date:"2012-01",distance:87},{date:"2012-02",distance:22},{date:"2012-03",distance:32},{date:"2012-04",distance:12},{date:"2012-05",distance:32},{date:"2012-06",distance:22},{date:"2012-07",distance:22},{date:"2012-08",distance:12},{date:"2012-09",distance:12},{date:"2012-10",distance:21},{date:"2012-11",distance:22},{date:"2012-12",distance:22},{date:"2013-1",townName:"Salt Lake City",distance:21},{date:"2013-2",distance:12},{date:"2013-3",distance:35},{date:"2013-4",distance:87},{date:"2013-5",distance:35},{date:"2013-6",distance:77},{date:"2013-7",distance:100},{date:"2013-8",distance:44},{date:"2013-9",distance:33},{date:"2013-10",distance:100},{date:"2013-11",distance:5},{date:"2013-12",distance:5}];initChartSample1(e,"date"),$(".repairTotal").text(106),$(".repairTypeNumber").text(33),$(".repairTypeSpan").text("本月报修量")}}var chart2,chart3,myBrowser=function(){var e=navigator.userAgent,t=e.indexOf("Opera")>-1;return t?"Opera":e.indexOf("Firefox")>-1?"FF":e.indexOf("Chrome")>-1?"Chrome":e.indexOf("Safari")>-1?"Safari":e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1&&!t?"IE":e.indexOf(".NET")?"Edge":void 0},initChartSample1=function(e,t,a){var i=myBrowser(),r=.1,s="#555";"IE"!=i&&"Edge"!=i||(r=0,s="#fff");var n={type:"serial",theme:"light",language:"zh",startDuration:1,fontFamily:"Microsoft YaHei",color:"#888",colors:["#4bca81"],precision:0,legend:{equalWidths:!1,useGraphSettings:!0,valueAlign:"right",valueWidth:120},dataProvider:e,valueAxes:[{id:"distanceAxis",axisAlpha:0,gridAlpha:0,position:"left",precision:0},{id:"latitudeAxis",axisAlpha:0,gridAlpha:0,labelsEnabled:!1,position:"right"},{id:"durationAxis",duration:"mm",durationUnits:{hh:"h ",mm:"min"},axisAlpha:0,gridAlpha:0,inside:!0,position:"right",title:"duration"}],graphs:[{precision:0,alphaField:"alpha",balloonText:"[[value]]单",dashLengthField:"dashLength",fillAlphas:1,legendPeriodValueText:"总共: [[value.sum]] 单",legendValueText:"[[value]] 单",title:"完成单数",type:"column",valueField:"distance",valueAxis:"distanceAxis"}],chartCursor:{categoryBalloonDateFormat:"DD",cursorAlpha:r,cursorColor:"#000",fullWidth:!0,valueBalloonsEnabled:!1,zoomable:!1},categoryField:t,categoryAxis:{dateFormats:[{period:"DD",format:"DD"},{period:"WW",format:"MMM DD"},{period:"MM",format:"MMM"},{period:"YYYY",format:"YYYY"}],autoGridCount:!0,axisColor:s,gridAlpha:0,gridColor:"#000",gridCount:50,gridPosition:"start",labelRotation:0},exportConfig:{menuBottom:"20px",menuRight:"22px",menuItems:[{icon:Metronic.getGlobalPluginsPath()+"amcharts/amcharts/images/export.png",format:"png"}]}};a&&(n.dataDateFormat=a);var l=AmCharts.makeChart("chart5",n);$("#chart5").closest(".portlet").find(".fullscreen").click(function(){l.invalidateSize()})},initChartSample2=function(){initChart2()},initChart2=function(){isDev?abp.ajax({url:"/api/services/app/order/ReportOrderCurrentStatesCountAsync",success:function(e){if(e.unPublish||e.working||e.unBack||e.unCheck){$("#fristPic").children(".portlet-body").hasClass("on")?$(this).next().removeClass("on"):($(this).addClass("on"),$(this).next().removeClass("on"));var t=[];t.push({title:"待派工",value:e.unPublish}),t.push({title:"处理中",value:e.working}),t.push({title:"待回访",value:e.unBack}),t.push({title:"待审核",value:e.unCheck}),chart2=AmCharts.makeChart("chartdiv1",{type:"pie",theme:"light",startDuration:1,addClassNames:!1,legend:{position:"right",marginRight:100},dataProvider:t,titleField:"title",valueField:"value",labelRadius:3,balloonText:"[[title]]:</b> [[percents]]%<br><span style='font-size:14px'><b>[[value]]</span>",radius:"26%",innerRadius:"80%",labelText:"",export:{enabled:!0}})}else $("#fristPic").children(".portlet-body").removeClass("on").next().addClass("on")}}):chart2=AmCharts.makeChart("chartdiv1",{type:"pie",theme:"light",startDuration:1,addClassNames:!1,legend:{position:"right",marginRight:100},dataProvider:[{marginRight:100}],dataProvider:[{title:"待审核",value:68},{title:"遗留问题",value:23},{title:"已发布",value:123},{title:"处理中",value:78},{title:"未发布",value:98}],titleField:"title",valueField:"value",labelRadius:3,balloonText:"[[title]]:</b> [[percents]]%<br><span style='font-size:14px'><b>[[value]]</span>",radius:"32%",innerRadius:"80%",labelText:"",export:{enabled:!0}})},initChartSample3=function(e){if(isDev){var t=moment().startOf("day").format("YYYY-MM-DD HH:mm"),a=moment().format("YYYY-MM-DD HH:mm");switch(e){case 2:t=moment().startOf("week").format("YYYY-MM-DD HH:mm");break;case 3:t=moment().startOf("month").format("YYYY-MM-DD HH:mm")}abp.ajax({url:"/api/services/app/order/ReportPersonalOrderCurrentStatesCountByTimeAsync?userid="+abp.session.userId+"&startTime="+t+"&endTime="+a,success:function(e){if(e[0]||e[1]||e[2]||e[3]||e[4]){var t=$("#secondChart").children(".portlet-body");t.hasClass("on")?t.next().removeClass("on"):(t.addClass("on"),t.next().removeClass("on"));var a=[];a.push({title:"电话报修创建",value:e[0]}),a.push({title:"微信报修创建",value:e[1]}),a.push({title:"已派工",value:e[2]}),a.push({title:"已回访",value:e[3]}),a.push({title:"已审核",value:e[4]}),chart3=AmCharts.makeChart("chartdiv2",{type:"pie",theme:"light",dataProvider:a,titleField:"title",valueField:"value",labelRadius:20,radius:"28%",innerRadius:"40%",labelText:"[[title]] <br>共[[value]]件",balloonText:"[[title]]:[[percents]]%<br><span style='font-size:14px'>共<b>[[value]]</b>件 </span>",export:{enabled:!0}})}else $("#secondChart").children(".portlet-body").removeClass("on").next().addClass("on")}})}else chart3=AmCharts.makeChart("chartdiv2",{type:"pie",theme:"light",dataProvider:[{title:"客户回访：",value:88},{title:"微信报修：",value:30},{title:"电话报修：",value:100},{title:"其它：",value:27}],titleField:"title",valueField:"value",labelRadius:20,radius:"32%",innerRadius:"40%",labelText:"[[title]] <br>约[[value]]件",balloonText:"[[title]]:[[percents]]%<br><span style='font-size:14px'>约<b>[[value]]</b>件 </span>",export:{enabled:!0}})},ChartsAmcharts=function(){return{init:function(){statisticsDay(),initChartSample2(),initChartSample3(3)}}}();
function showThisMonthData(){$(".myJobs>a").eq(2).trigger("click")}function backTopTop(){$(document).scroll(function(){$(".scroll-to-top").addClass("alwaysHide"),$(window).scrollTop()>=$(document).height()-$(window).height()&&$(".scroll-to-top").addClass("alwaysShow").removeClass("alwaysHide")})}function pressEnterToSearch(){document.onkeydown=function(e){var t=e||window.event||arguments.callee.caller.arguments[0];t&&13==t.keyCode&&queryOrder($("#queryKey").val())}}function queryOrder(){var e=$(".orderQuery .selectType").attr("val"),t=$("#queryKey").val();window.location.href="/ServiceOrder/Order/QueryResult?keyWord="+t+"&type="+e}function weixinQueryOrder(e){var t="";$(e).find(".assetId").val()&&(t="&assetId="+$(e).find(".assetId").val()),window.location.href="/ServiceOrder/Order/CreateServieOrder?onlineRepairId="+$(e).find(".onlineRepairId").val()+t}function getOnlineRepairs(e){var t=JSON.stringify({MaxResultCount:1e3,SkipCount:0,Sorting:"CreationTime Desc",states:[0]});abp.ajax({url:"/api/services/app/onlineRepair/GetOnlineRepairs",data:t,success:function(t){if(0!=t){$("#weixin-box").hasClass("alwaysShow")?$(this).next().removeClass("on"):($(this).addClass("alwaysShow"),$(this).next().removeClass("on")),t=t.items;for(var a=[],i="<div class='portlet-body onlineRepairBody' onclick='weixinQueryOrder(this)'>                                    <div class='media' style='border-bottom:1px solid #e5e5e5'>                                       <a href='javascript:;' class='pull-left'><img alt='' src='/images/default/default-icon-new.png' data-original='$img' class='media-object lazy' width='40' height='40'></a>                                       <h4 class='media-heading'>                                           <span class='pull-left weixin-name bold onlineRepairName'>$name</span>                                           <span class='label label-sm label-danger new hide'>new</span>                                           <span class='pull-right font-default'><i class='fa fa-clock-o label-sm'></i><small class='font-default small onlineRepairsCreateTime'>$date</small></span>                                       </h4>                                      <p class='weixin-describe onlineRepairproblem'>报修描述：$faultDescription</p>                                      <input class='onlineRepairId' type='hidden' value='$onlineRepairId' />                                      <input class='assetId' type='hidden' value='$assetId' />                                   </div>                                 </div>",n=t.length>10?10:t.length,o=0;o<n;o++){var r=t[o],s=(new Date).getTime()-moment(r.creationTime).toDate().getTime();s=s<0?0:s,a.push(i.replace("$img",r.headImgUrl||"").replace("$name",r.name||"").replace("$date",getTime(s)).replace("$faultDescription",r.faultDescription).replace("$onlineRepairId",r.id).replace("$assetId",r.assetId||""))}var l=a.join("");l&&l.trim()||$(".weixin-form .none-result").addClass("on"),$("#weixin-box").html(l),"function"==typeof e&&e(),$("img.lazy").lazyload()}else $("#weixin-box").removeClass("alwaysShow").next().addClass("on")}})}function getTime(e){var t=Math.floor(e/864e5),a=e%864e5,i=Math.floor(a/36e5);i=1==i.toString().length?"0"+i:i;var n=a%36e5,o=Math.floor(n/6e4);o=1==o.toString().length?"0"+o:o;var r=n%6e4,s=Math.round(r/1e3);return s=1==s.toString().length?"0"+s:s,t+"天 "+i+":"+o+":"+s}$(function(){function e(){var e=JSON.stringify({MaxResultCount:6,OrderStateEnums:[$.fsm.enums.orderStatus.Submitted.key],SkipCount:0,Sorting:"LastModificationTime DESC"});abp.ajax({url:"/api/services/app/order/GetOrders",data:e,success:function(e){if(e.totalCount>0){var t=[],a="<tr><td>$code</td><td>$date</td><td class='textRight'><a href='/ServiceOrder/OrderDetail/Index?id=$id'><i class='fa glyphicon  handle-icon'>立即查看</i></a></td></tr>";return $.each(e.items,function(e,i){t.push(a.replace("$code",i.code).replace("$id",i.id).replace("$date",moment(i.operation[0].creationTime).format("YYYY-MM-DD")))}),void $("#visit table tbody").append(t.join(""))}$(".visit .none-result").addClass("on")},error:function(e){abp.log.error(e),$("#visit table tbody").append("暂无需回访服务单。")}})}function t(){abp.ajax({url:"/api/services/app/order/ReportOrderCountByPersonalAsync?id="+abp.session.userId,success:function(e){$("#ordercountbypersonal").text("我已创建"+e+"单")}})}function a(){$("body").resize(function(){var e=$("body").width();e<1182?$("#fristPic").css({marginRight:"0px",marginBottom:"10px"}):$("#fristPic").css({marginRight:"10px",marginBottom:"0px"})}),$(".page-content").addClass("mainPageBgColor")}a(),page.init(),ChartsAmcharts.init(),getOnlineRepairs(),e(),t(),backTopTop(),showThisMonthData()});var page=function(){var e=function(){var e=document.getElementById("visit"),t=document.getElementById("weixin"),a=document.documentElement.clientWidth;a<=1024&&a>=768&&(e.style.height="675px"),a<=768&&(e.style.height="562px"),a<=1024&&a>=768&&(t.style.height="412px"),a<=768&&(t.style.height="408px")},t=function(){$(".totalChart").click(function(){$(".totalChart").removeClass("active"),$(this).addClass("active")}),$(".bottomChartSecond").click(function(){$(".bottomChartSecond").removeClass("bottomChartActive"),$(this).addClass("bottomChartActive")})},a=function(){$(".form_time").datetimepicker({language:"fr",format:"yyyy-MM",startView:3,minView:3,maxView:4,todayBtn:!0,todayHighlight:1,autoclose:!0,pickerPosition:"bottom-right"}),$("th[class=prev] i").attr("class","fa fa-chevron-left"),$("th[class=next] i").attr("class","fa fa-chevron-right")},i=function(){$("#queryKey").bind("focus",function(){$("#mainPageDropdownButton").css("borderRightColor","#999")}),$("#queryKey").bind("blur",function(){$("#mainPageDropdownButton").css("borderRightColor","#e5e5e5")}),$("#mainPageDropdownButton").bind("click",function(){$("#mainPageDropdownButton i").removeClass("fa-angle-down"),$("#mainPageDropdownButton i").addClass("fa-angle-up")}),$("#mainPageDropdownButton").next().children().bind("click",function(){$(this).find("a").addClass("selectType");var e=$(this).html(),t=$(this).text().match(/设备|电话|网点/g),a=e+"<i class='fa fa-angle-down'></i>";if($("#mainPageDropdownButton").html(a),t)switch(t[0]){case"设备":$("#queryKey").attr("placeholder","请输入设备编号");break;case"电话":$("#queryKey").attr("placeholder","请输入电话号码");break;case"网点":$("#queryKey").attr("placeholder","请输入网点名称")}})},n=function(){$("#mainPageDropdownButton").bind("click",function(){var e=$(this).attr("aria-expanded");"true"==e?$("#mainPageDropdownButton i").attr("class","fa fa-angle-down"):$("#mainPageDropdownButton i").attr("class","fa fa-angle-up")})};return{init:function(){e(),t(),a(),i(),n()}}}();
$(function(){$(".mainPageTitleColor").click(function(){console.log($(this).index()),$(".mainPageTitleColor").removeClass("activeButton"),$(this).addClass("activeButton");for(var i=0;i<3;i++)$(".chartList").index=i;$(".chartList").addClass("hide"),$(".chartList").eq($(this).index()).removeClass("hide")})});